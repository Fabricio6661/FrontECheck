<div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-12">
        <div class="card shadow p-4 rounded-4">
          
          <h2 class="text-center fw-bold mb-4">Gerenciar Reservas</h2>
  
          <div class="card p-3 mb-4 bg-light border-0">
              <h5 class="fw-bold mb-3 text-primary text-center">Nova Reserva</h5>
              <div class="row g-3">
                 
                <div class="col-md-4">
                    <label class="form-label fw-semibold">Unidade</label>
                    <select class="form-select" [(ngModel)]="novaReserva.unidadeId" (change)="aoMudarUnidade()">
                        <option [ngValue]="null">Selecione a unidade</option>
                        <option *ngFor="let u of unidades" [ngValue]="u.id">{{ u.nome }}</option>
                    </select>
                </div>
                
                <div class="col-md-4">
                    <label class="form-label fw-semibold">Formul√°rio (Opcional)</label>
                    <select class="form-select" [(ngModel)]="novaReserva.formularioId"
                        [disabled]="!novaReserva.unidadeId || formulariosFiltrados?.length === 0">
                        <option [ngValue]="null">Padr√£o (Autom√°tico)</option>
                        <option *ngFor="let f of formulariosFiltrados" [ngValue]="f.id">
                            {{ f.nome }}
                        </option>
                    </select>
                
                    <div *ngIf="novaReserva.unidadeId && formulariosFiltrados?.length === 0" class="form-text text-warning">
                        Nenhum formul√°rio encontrado para esta unidade.
                    </div>
                </div>
  
                  <div class="col-md-4">
                      <label class="form-label fw-semibold">Email do H√≥spede</label>
                      <input type="email" class="form-control" [(ngModel)]="novaReserva.email" placeholder="email@exemplo.com">
                  </div>
                  <div class="col-md-4">
                      <label class="form-label fw-semibold">CPF</label>
                      <input type="text" class="form-control" [(ngModel)]="novaReserva.cpf" placeholder="000.000.000-00">
                  </div>
  
                  <div class="col-md-2">
                      <label class="form-label fw-semibold">Check-in</label>
                      <input type="date" class="form-control" [(ngModel)]="novaReserva.dataCheckin">
                  </div>
                  <div class="col-md-2">
                      <label class="form-label fw-semibold">Check-out</label>
                      <input type="date" class="form-control" [(ngModel)]="novaReserva.dataCheckout">
                  </div>
  
                  <div class="col-md-12 d-flex align-items-end">
                      <button class="btn btn-primary w-100 fw-bold" (click)="salvarReserva()" [disabled]="loading">
                          {{ loading ? 'Salvando...' : 'Gerar Reserva' }}
                      </button>
                  </div>
              </div>
          </div>
  
          <hr class="my-4">
  
          <h5 class="fw-bold mb-3">Reservas Recentes</h5>
          <div class="table-responsive">
              <table class="table table-hover align-middle">
                  <thead class="table-light">
                      <tr>
                          <th>ID</th>
                          <th>H√≥spede</th>
                          <th>Unidade ID</th>
                          <th>Per√≠odo</th>
                          <th class="text-center">Link de Avalia√ß√£o</th>
                          <th class="text-center">A√ß√µes</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr *ngFor="let r of reservas">
                          <td>#{{ r.id }}</td>
                          <td>
                              <div class="fw-bold">{{ r.email }}</div>
                              <small class="text-muted">{{ r.cpf }}</small>
                            </td>
                            <td>{{ r.unidadeId }}</td>
                            <td>
                                <small class="d-block">Check-In: {{ r.dataCheckin | date:'dd/MM/yyyy' }}</small>
                                <small class="d-block">Check-Out: {{ r.dataCheckout | date:'dd/MM/yyyy' }}</small>
                            </td>
                            
                            <td class="text-center">
                                <button *ngIf="r.token" class="btn btn-sm btn-outline-success fw-bold" (click)="copiarLink(r.token)">
                                    üîó Copiar Link
                                </button>
                                <span *ngIf="!r.token" class="badge bg-warning text-dark">Sem Token</span>
                            </td>
                            
                            <td class="text-center">
                                <button class="btn btn-sm btn-outline-danger" (click)="deletarReserva(r.id!)" title="Excluir"><i class="bi bi-trash"></i></button>
                            </td>
                        </tr>
  
                      <tr *ngIf="reservas.length === 0">
                          <td colspan="6" class="text-center text-muted py-4">
                              Nenhuma reserva encontrada. Cadastre a primeira acima!
                          </td>
                      </tr>
                  </tbody>
              </table>
          </div>
  
        </div>
      </div>
    </div>
  </div>